<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Document</title>
    <script type="text/javascript" src="https://maps.googleapis.com/maps/api/js?key=AIzaSyB-hH8Oe7r8Uu5n51O2E-r0962S94JB-eM&libraries=places"></script>
</head>
<body>
    <input type="text" name="depart" id="depart" placeholder="Départ">
    <input type="text" name="arrivee" id="arrivee" placeholder="Arrivée">
    <input type="button" value="Calcul" id="calcul_avion">
</body>

<script>
    function initialize() {
        const input_depart = new google.maps.places.Autocomplete(
            document.getElementById('depart')
        );
        const input_arrivee = new google.maps.places.Autocomplete(
            document.getElementById('arrivee')
        );

        const button = document.getElementById("calcul_avion")
        button.addEventListener('click', () => {
            const depart = {
                lat: input_depart.getPlace().geometry.location.lat(),
                lng: input_depart.getPlace().geometry.location.lng()
            }
            const arrivee = {
                lat: input_arrivee.getPlace().geometry.location.lat(),
                lng: input_arrivee.getPlace().geometry.location.lng()
            }
            console.log(input_depart.getPlace())
            console.log(depart, arrivee);
            console.log(gcd(depart, arrivee));
        })
    }

    function gcd(depart, arrivee) {
        const R = 6371 // Earth radius, in km

        const lat1 = depart.lat * Math.PI / 180;
        const lng1 = depart.lng * Math.PI / 180;
        const lat2 = arrivee.lat * Math.PI / 180;
        const lng2 = arrivee.lng * Math.PI / 180;
        
        const dlat = Math.abs(lat1 - lat2)
        const dlng = Math.abs(lng1 - lng2)

        const dsigma = 2 * Math.asin(Math.sqrt(
            Math.pow(Math.sin(dlat/2), 2)
            + Math.cos(lat1) * Math.cos(lat2) * Math.pow(Math.sin(dlng/2), 2)
        ))
        return dsigma * R
    }

    google.maps.event.addDomListener(window, 'load', initialize);
</script>
</html>